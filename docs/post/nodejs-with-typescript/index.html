<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Node.js with TypeScript</title>
  <meta property="og:title" content="Node.js with TypeScript" />
  <meta name="twitter:title" content="Node.js with TypeScript" />
  <meta name="description" content="Setting up a Node.js app with TypeScript, Nodemon, and Mocha/Chai tests">
  <meta property="og:description" content="Setting up a Node.js app with TypeScript, Nodemon, and Mocha/Chai tests">
  <meta name="twitter:description" content="Setting up a Node.js app with TypeScript, Nodemon, and Mocha/Chai tests">
  <meta name="author" content="Divan Visagie"/>
  <link href='https://dvisagie.com/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://dvisagie.com/img/avatar.jpeg" />
  <meta name="twitter:image" content="https://dvisagie.com/img/avatar.jpeg" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://dvisagie.com/post/nodejs-with-typescript/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Divan Visagie" />

  <meta name="generator" content="Hugo 0.55.1" />
  <link rel="canonical" href="https://dvisagie.com/post/nodejs-with-typescript/" />
  <link rel="alternate" href="https://dvisagie.com/index.xml" type="application/rss+xml" title="Divan Visagie">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://dvisagie.com/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://dvisagie.com/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://dvisagie.com/css/highlight.min.css" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140923268-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://dvisagie.com">Divan Visagie</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="https://dvisagie.com/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://dvisagie.com/page/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Divan Visagie" href="https://dvisagie.com">
            <img class="avatar-img" src="https://dvisagie.com/img/avatar.jpeg" alt="Divan Visagie" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Node.js with TypeScript</h1>
                
                  
                    <h2 class="post-subheading">Setting up a Node.js app with TypeScript, Nodemon, and Mocha/Chai tests</h2>
                  
                
                
                  <span class="post-meta">
  Posted on 2 January 2019
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p><img src="https://dvisagie.com/img/node-ts-head.png" alt="Header Image" /></p>

<blockquote>
<p>The idea with this article is to simply provide a quick tutorial on how to set up a simple <a href="https://nodejs.org/">Node.js</a> project with nodemon for development reloading and of course unit tests. This means I have gone for a minimalist approach and tried to keep everything as generic as possible by not doing things like sticking to my preference of <a href="https://yarnpkg.com/en/">Yarn</a> or adding unnecessary dependencies.</p>
</blockquote>

<p>Let’s start off the same way we start any node project, running <a href="https://www.npmjs.com/">npm</a> init in our project’s folder.</p>

<pre><code class="language-bash">npm init
</code></pre>

<p>When prompted by npm to answer the questions you have the option of just pressing enter every time and filling out your package.json later, but I took this opportunity to sneak in our test command:</p>

<pre><code class="language-bash">mocha -r ts-node/register test/**/*.spec.ts
</code></pre>

<p>Here we get a glimpse of the tool that is helping us achieve this whole thing; <a href="https://github.com/TypeStrong/ts-node">ts-node</a> provides TypeScript execution for Node.js, and here it allows us to execute mocha tests that were written in TypeScript.</p>

<p>You will also notice that I set our main option to <em>index.ts</em> instead of <em>index.js</em>, later on this will tell tools like nodemon where to look for our starting point.</p>

<p><img src="https://dvisagie.com/img/node-ts-1.png" alt="Image" /></p>

<p>Next we need to set up TypeScript in the project</p>

<pre><code class="language-bash">npm i typescript
</code></pre>

<p>While we are here, let’s also install ts-node:</p>

<pre><code class="language-bash">npm i -D ts-node
</code></pre>

<p>You have the option of also installing TypeScript globally but I chose to run the locally installed module for the next step using <a href="https://www.npmjs.com/package/npx">npx</a>.</p>

<p>So, lets initialise our TypeScript project.</p>

<pre><code class="language-bash">npx tsc --init
</code></pre>

<p>We should now have our default <em>tsconfig.json</em> file</p>

<h1 id="something-to-execute">Something to execute</h1>

<p>In this next bit we need to write some TypeScript to execute. I have gone for a simple express app here in <em>index.ts</em>:</p>

<pre><code class="language-ts">import express, {Express} from 'express'

const port: number = 3000
const app: Express = express()

app.get('/', (req, res) =&gt; {
    res.json({message: 'Hello World'})
})

app.listen(port, () =&gt; {
    console.log(`Express is listening on port ${port}`)
}
</code></pre>

<p>At this point if we run the app having only installed the express module (<code>npm i express</code> ):</p>

<pre><code class="language-bash">npx ts-node index.ts
</code></pre>

<p>We will get the following error:</p>

<p><img src="https://dvisagie.com/img/node-ts-2.png" alt="Image" /></p>

<p>This is because the default <em>tsconfig.json</em> has strict type checking enabled, removing <code>“strict”: true</code> would indeed fix this error, but since you are going through the effort of setting up TypeScript, you probably really want type safety. So the other option is to install the types for any packages you may need, in this example, for express:</p>

<pre><code class="language-bash">npm i @types/express
</code></pre>

<p>Now when we run <code>npx ts-node index.ts</code> we should get a running express server:</p>

<p><img src="https://dvisagie.com/img/node-ts-3.png" alt="Image" /></p>

<p>We don’t however want to be running our app via ts-node in production, so let’s set up a start script that will build our JavaScript and run our app in the regular Node.js environment.</p>

<p>Currently if we had to run <code>tsc</code> it would output our <em>index.js</em> right next to our source code. Some people prefer it this way and that’s completely fine, but my personal preference is to have output go to a build directory, we can do this by setting the outDir property in our <em>tsconfig.json</em>:</p>

<pre><code class="language-json">{
...
    &quot;outDir&quot;: &quot;./build&quot;,
...
}
</code></pre>

<p>We can now set up our <code>build</code> and <code>start</code> scripts in our <em>package.json:</em></p>

<pre><code class="language-json">{
...
    &quot;scripts&quot;: {
        &quot;build&quot;: &quot;tsc&quot;,
        &quot;start&quot;: &quot;tsc &amp;&amp; node ./build/index.js&quot;,
        &quot;test&quot;: &quot;mocha -r ts-node/register test/**/*.spec.ts&quot;
    },
...
}
</code></pre>

<h1 id="unit-testing">Unit Testing</h1>

<p>Now that we have a running TypeScript app, we want to set up some unit testing. Since we already set up mocha with ts-node in the beginning we should be able to simply run it once written, you don’t have to just use mocha though, ts-node also <a href="https://github.com/TypeStrong/ts-node#tape">officially</a> supports <a href="https://github.com/substack/tape">tape</a>, and you can probably get it to run other tests as well.</p>

<p>Lets start off by installing our dependencies, remembering to also install the typings for mocha and chai:</p>

<pre><code class="language-bash">npm i -D mocha chai @types/mocha @types/chai
</code></pre>

<p>Then we create a simple test (I called mine <em>default.spec.ts</em>) inside a folder named <em>test</em>:</p>

<pre><code class="language-javascript">import {expect} from 'chai'

describe('When we run tests', () =&gt; {
    it('Should actually work' , () =&gt; {
        expect(true).to.be.eq(true)
    })
}
</code></pre>

<p>This certainly isn’t a useful test but this isn’t a unit testing tutorial, we just want to see that test’s run in our setup. Let’s run <code>npm test</code>:</p>

<p><img src="https://dvisagie.com/img/node-ts-4.png" alt="Image" /></p>

<p>Neat! our test’s work.</p>

<h1 id="nodemon">Nodemon</h1>

<p><a href="https://nodemon.io/">Nodemon</a> is a neat tool that will run and reload your application when the source code changes. Honestly once you work with a tool like this you want it everywhere because it comes in really handy during development.</p>

<p>First, lets install nodemon</p>

<pre><code class="language-sh">npm i -D nodemon
</code></pre>

<p>Next we configure nodemon to work with our TypeScript files. Nodemon can be configured either as a property inside your <em>package.json</em> or in it’s own <em>nodemon.json</em> file, which is the method I chose to use here:</p>

<pre><code class="language-json">{
    &quot;ext&quot;: &quot;ts&quot;,
    &quot;exec&quot;: &quot;npm start&quot;
}
</code></pre>

<blockquote>
<p><strong>Pro Tip:</strong> The nodemon config supports an env property so you can set environment variables, I use this to set environment variables for dev that will be different in production, ie:
<code>“env”: { “DEBUG”: “app,app:*” }</code></p>
</blockquote>

<p>Now if we simply run <code>npx nodemon</code> our app will restart when we make code changes, go add a line to your index.ts and watch the magic!</p>

<p>And that’s a wrap! You should now have a nicely set up TypeScript Node.js application. Enjoy the type safety!</p>

      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://dvisagie.com/post/building-a-desktop-ui-in-go/" data-toggle="tooltip" data-placement="top" title="Building a Desktop UI in Go">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://dvisagie.com/post/moving-from-medium/" data-toggle="tooltip" data-placement="top" title="Moving from Medium">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dvisagie-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://gitlab.com/divan" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/divanvisagie" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/divan-visagie" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.instagram.com/divanvisagie" title="Instagram">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://dvisagie.com/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Divan Visagie
          &nbsp;&bull;&nbsp;
          2019

          
            &nbsp;&bull;&nbsp;
            <a href="https://dvisagie.com">Divan Visagie</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.55.1</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://dvisagie.com/js/main.js"></script>
<script src="https://dvisagie.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>





  </body>
</html>

